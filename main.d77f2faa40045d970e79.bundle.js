(()=>{"use strict";var e,t={790:(e,t,i)=>{i(260);class s extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.atlas("flares","assets/particles/flares.png","assets/particles/flares.json"),this.load.atlas("confetti","assets/particles/confetti.png","assets/particles/confetti.json"),this.load.atlas("ui","assets/ui/nine-slice.png","assets/ui/nine-slice.json"),this.load.image("flare","assets/particles/white-flare.png"),this.load.atlas("tiles","assets/images/tiles.png","assets/images/tiles.json")}init(){this.registry.set("level",1),this.registry.set("score",0)}update(){this.scene.start("HUDScene"),this.scene.start("GameScene"),this.scene.bringToTop("HUDScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const a={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,milestone:2e3,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"],shape:["flower1","flower2","butterfly","infinity","hexagon"],matchScore:["0","0","0","100","200","300","400","500"],triangle:[255,87.5,255-200*Math.cos(Math.PI/6),287.5+200*Math.sin(Math.PI/6),255+200*Math.cos(Math.PI/6),287.5+200*Math.sin(Math.PI/6)],circle:[255,287.5,200],ellipse:[255,287.5,200,300],rectangle:[255-200*Math.cos(Math.PI/4),287.5-200*Math.sin(Math.PI/4),400*Math.cos(Math.PI/4),400*Math.cos(Math.PI/4)],star:[255,87.5,255+200*Math.sin(2*Math.PI/5),287.5-200*Math.cos(2*Math.PI/5),255+200*Math.sin(Math.PI/5),287.5+200*Math.cos(Math.PI/5),255-200*Math.sin(Math.PI/5),287.5+200*Math.cos(Math.PI/5),255-200*Math.sin(2*Math.PI/5),287.5-200*Math.cos(2*Math.PI/5)],hexagon:[255-200*Math.sin(Math.PI/6),287.5-200*Math.cos(Math.PI/6),255+200*Math.sin(Math.PI/6),287.5-200*Math.cos(Math.PI/6),455,287.5,255+200*Math.sin(Math.PI/6),287.5+200*Math.cos(Math.PI/6),255-200*Math.sin(Math.PI/6),287.5+200*Math.cos(Math.PI/6),55,287.5],flower1:[375.12946241895736,300.12611528042135,392.5996072288922,316.74769939971884,406.00735106701006,336.56526263762873,414.2442037328078,358.4000874709627,416.60254037844385,380.8012701892219,412.8437878668761,402.18022466674205,403.2218625844297,420.9595645243792,388.4595645243792,435.7218625844297,369.68022466674205,445.3437878668761,348.3012701892219,449.10254037844385,325.9000874709627,446.7442037328078,304.0652626376288,438.50735106701006,284.24769939971884,425.0996072288922,267.62611528042135,407.6294624189574,255.00000000000003,387.50000000000006,242.3738847195787,407.62946241895736,225.75230060028125,425.0996072288921,205.93473736237132,438.50735106701006,184.09991252903745,446.7442037328077,161.69872981077822,449.10254037844385,140.31977533325804,445.34378786687614,121.54043547562085,435.7218625844298,106.77813741557031,420.95956452437923,97.15621213312394,402.1802246667421,93.39745962155615,380.8012701892219,95.75579626719227,358.40008747096266,103.99264893298997,336.5652626376287,117.4003927711079,316.7476993997187,134.87053758104275,300.12611528042123,154.99999999999983,287.49999999999994,134.8705375810424,274.87388471957854,117.40039277110765,258.252300600281,103.99264893298977,238.43473736237098,95.75579626719212,216.599912529037,93.39745962155612,194.19872981077776,97.156212133124,172.8197753332576,106.77813741557051,154.0404354756205,121.54043547562111,139.2781374155701,140.31977533325826,129.65621213312383,161.69872981077833,125.89745962155612,184.09991252903754,128.2557962671923,205.93473736237138,136.49264893299,225.75230060028125,149.9003927711079,242.37388471957868,167.37053758104264,254.99999999999997,187.5,267.6261152804213,167.37053758104267,284.2476993997187,149.9003927711079,304.06526263762856,136.49264893299,325.9000874709624,128.25579626719227,348.3012701892216,125.8974596215561,369.68022466674165,129.65621213312377,388.45956452437883,139.27813741557,403.2218625844294,154.04043547562037,412.8437878668759,172.81977533325738,416.6025403784438,194.19872981077742,414.24420373280793,216.59991252903657,406.00735106701046,238.4347373623705,392.59960722889275,258.2523006002804,375.12946241895816,274.87388471957803,355.0000000000009,287.49999999999955,375.1294624189565,300.12611528042066],flower2:[380.19231026610385,300.65824203166216,401.7221401100709,318.6867536226639,417.3555028259111,340.2525006599358,425.4699031472974,363.3980908629447,425.2541707522247,385.7962913144534,416.8033988749895,405.05705045849464,401.09676050790915,419.0461140201344,379.86147099153146,426.17271230317704,355.3412190069926,425.60783971926315,329.99999999999994,417.40381056766574,306.20078326448834,402.4988420647404,285.90169943749476,382.60565162951536,281.1723196100862,410.63108287250503,270.67926949014804,436.67828430524094,255.00000000000006,458.21067811865476,235.49472321240108,473.0803121377047,214.126103743394,479.7965630205276,193.1966011250106,477.71130325903073,175.03859288791665,467.0962608668656,161.69872981077816,449.102540378444,154.65878099300738,425.60783971926327,154.63040904617122,398.97172382160926,161.45151404196667,371.7314350945529,174.09830056250527,346.2785252292473,145.98307281735475,350.44095225512604,117.96818135360974,348.51049646137005,92.64449717408885,340.2525006599358,72.47517283799198,326.2968496809714,59.48437210855562,308.0495205520187,55,287.49999999999983,59.48437210855579,266.950479447981,72.4751728379922,248.70315031902837,92.64449717408914,234.74749934006405,117.96818135361028,226.48950353862992,145.9830728173552,224.55904774487396,174.09830056250507,228.72147477075234,161.4515140419665,203.26856490544665,154.63040904617122,176.0282761783904,154.65878099300738,149.39216028073642,161.69872981077816,125.89745962155584,175.0385928879167,107.90373913313431,193.19660112501066,97.28869674096924,214.12610374339403,95.2034369794724,235.49472321240103,101.91968786229532,254.99999999999997,116.78932188134519,270.67926949014793,138.32171569475886,281.17231961008616,164.36891712749474,285.9016994374947,192.39434837048444,306.2007832644881,172.5011579352597,329.9999999999996,157.5961894323344,355.3412190069922,149.39216028073687,379.86147099153095,148.82728769682282,401.0967605079087,155.9538859798654,416.80339887498917,169.9429495415049,425.25417075222447,189.20370868554596,425.4699031472975,211.60190913705452,417.35550282591146,234.74749934006343,401.72214011007156,256.3132463773353,380.19231026610487,274.3417579683372,355.0000000000011,287.49999999999955,380.1923102661027,300.6582420316614],infinity:[275.9056926535307,308.29116908177593,296.58233816355187,328.17366430758,316.80339887498945,346.2785252292473,336.34732861516,361.81448254773943,355,374.10254037844385,372.55705045849464,382.60565162951536,388.8261212717716,386.95218953682735,403.62896509547886,386.95218953682735,416.8033988749895,382.60565162951536,428.20508075688775,374.10254037844385,437.70909152852016,361.81448254773943,445.21130325903073,346.2785252292473,450.62952014676114,328.17366430758005,453.9043790736547,308.291169081776,455,287.50000000000006,453.9043790736547,266.7088309182241,450.62952014676114,246.82633569242006,445.21130325903073,228.72147477075276,437.7090915285202,213.18551745226065,428.2050807568878,200.8974596215562,416.80339887498957,192.3943483704847,403.62896509547886,188.04781046317265,388.8261212717717,188.04781046317265,372.55705045849464,192.39434837048464,355,200.89745962155615,336.34732861516,213.1855174522606,316.8033988749894,228.72147477075274,296.58233816355175,246.82633569242006,275.9056926535306,266.7088309182242,254.99999999999986,287.50000000000017,234.09430734646912,308.2911690817761,213.41766183644793,328.1736643075802,193.1966011250103,346.2785252292475,173.65267138483972,361.8144825477396,154.99999999999972,374.102540378444,137.4429495415051,382.6056516295155,121.17387872822809,386.9521895368274,106.37103490452091,386.9521895368273,93.19660112501032,382.60565162951525,81.79491924311213,374.10254037844373,72.29090847147972,361.8144825477393,64.78869674096924,346.2785252292472,59.37047985323886,328.17366430757994,56.09562092634533,308.29116908177593,55,287.50000000000006,56.09562092634533,266.7088309182242,59.370479853238834,246.82633569242012,64.78869674096921,228.72147477075288,72.29090847147972,213.18551745226077,81.7949192431121,200.89745962155632,93.19660112501029,192.39434837048475,106.37103490452085,188.0478104631727,121.17387872822798,188.0478104631726,137.4429495415049,192.39434837048447,154.99999999999943,200.8974596215558,173.65267138483932,213.18551745226011,193.1966011250098,228.72147477075208,213.41766183644734,246.82633569241924,234.09430734646844,266.7088309182232,254.99999999999906,287.4999999999991,275.9056926535297,308.29116908177497],butterfly:[208.6565179078539,292.3708962448436,248.1870164341468,288.94814436147215,300.9962793638555,272.5549028812522,356.59790908226034,242.26569650920905,404.10090290685577,201.4165535703106,434.74097991349186,156.91053406749083,443.8139879170225,117.4911216595095,431.53285770794446,91.44039895099576,402.6180701062365,84.32115717092984,364.7670503870754,97.37789173261228,326.4407413995502,127.04146766162901,294.5780911650855,165.69116038839505,272.8561558078797,203.49339174671064,260.9543474624969,230.84816815472897,255,240.80921850579043,249.04548043609154,230.84653071917617,237.1431419700486,203.49008805160832,215.42027775271873,165.68614043357312,183.55623447161292,127.03467535705201,145.22798167087996,97.36928700458176,107.37436461696097,84.31074446071528,78.45621347555797,91.4282612706211,66.17083834440973,117.47745916393583,75.23861086659045,156.89570590125717,105.87236805441435,201.4011215526047,153.36788945748813,242.25046903802564,208.9608620095596,272.5409772693213,261.76029786204464,288.9369456694214,301.27987201915386,292.3642105567665,319.9245091162626,287.49999999999994,314.79425604846904,281.21537044474553,288.3405906500234,280.4132386873833,247.7064885799628,289.86980551506974,202.9225803419872,310.686361088598,164.4273309957152,339.79215483084687,140.55117383173234,370.65193949153957,135.60765504384568,395.00135025672455,149.06861650803572,405.14872021934656,176.0099986592213,396.2204097434419,208.6777447508187,367.7324996127564,238.72948481057708,324.0441754458111,259.53525269147656,273.54192745451286,267.91478853476787,226.74069700178399,264.8505419286545,193.77835401918026,255.00000000000003,181.94563571266713,245.16121470593916,193.89021092545917,242.13208168116796,226.96120403091322,250.56961755412456,273.86468488293883,271.4554827758837,324.45961944698234,301.60830270507984,368.22794833974854,334.3966618474394,396.78012991257947,361.47639634226095,405.75401831162884,375.09130102904265,395.63069313153994,370.3148046204195,371.2811096653644,346.61586770736676,340.3944458828897,308.3047833092803,311.2328185934475,263.7083626752422,290.32951855512573,223.2610897190618,280.7536863595303,196.989272506272,281.4028268495659,192.0312499999997,287.4999999999997,210.83358632606652,292.14207713362606]};class l extends Phaser.GameObjects.Sprite{constructor(e){if(super(e.scene,e.x,e.y,e.texture,e.frame),this.isRevealed=!1,this.setOrigin(.5,.5),this.setScale(.8),this.setInteractive(),e.delay){const t=this.y;this.y=t-this.height,this.scene.tweens.add({targets:this,y:t,ease:"Power3",autoDestroy:!0,duration:200,delay:e.delay})}this.scene.add.existing(this)}revealImageWithDelay(e,t,i){this.scene.tweens.add({targets:this,x:e,y:t,alpha:1,ease:"Power3",autoDestroy:!0,duration:400,delay:i,onComplete:()=>{this.isRevealed=!0}})}getSelected(){this.selectedTween?this.selectedTween.resume():this.selectedTween=this.scene.add.tween({targets:this,angle:180,yoyo:!0,loop:-1})}getDeselected(){this.selectedTween&&this.selectedTween.pause(),this.angle=0}getAttracted(e){let t;"LEFT"==e?t={x:this.x-10}:"RIGHT"==e?t={x:this.x+10}:"UP"==e?t={y:this.y-10}:"DOWN"==e&&(t={y:this.y+10}),this.suggestedTween||(this.suggestedTween=this.scene.tweens.add({targets:this,yoyo:!0,ease:"sine.in",autoDestroy:!0,repeat:0,duration:500,onStart:()=>{this.setPipeline("Custom").setBlendMode("NORMAL")},onComplete:()=>{var e;null===(e=this.suggestedTween)||void 0===e||e.stop(),this.suggestedTween=void 0,this.setAlpha(1),this.resetPipeline()},scale:.9}))}enableExplode3(){this.matchExplode3||(this.matchExplode3=this.scene.add.particles(this.x,this.y,"flare",{speed:50,advance:20,duration:100,lifespan:250,scale:.5,emitting:!1,maxAliveParticles:5,delay:20}).setActive(!1).startFollow(this,-this.x,-this.y)),this.matchExplode3.setActive(!0),this.matchExplode3.start()}enableGlow4(){this.matchGlow4||(this.matchGlow4=this.scene.add.particles(this.x,this.y,"flares",{frame:"white",color:[16436258,16291840,16266752,10421252],colorEase:"quad.out",lifespan:500,angle:{min:-0,max:-360},scale:{start:.5,end:0,ease:"sine.out"},speed:100,blendMode:"NORMAL",emitting:!1}).setActive(!1).setDepth(-1).startFollow(this,-this.x,-this.y)),this.isGlow4=!0,this.matchGlow4.setActive(!0),this.scene.time.delayedCall(300,(()=>this.matchGlow4.start()))}enableGlow5(e){this.matchGlow5||(this.matchGlow5=this.scene.add.particles(this.x,this.y,"flare",{frame:"white",color:[9887962,9666291],colorEase:"quart.out",lifespan:300,angle:[0,90,180,270],scale:{start:.5,end:0,ease:"sine.in"},speed:100,blendMode:"NORMAL",emitting:!1}).setActive(!1).setDepth(-1).startFollow(this,-this.x,-this.y)),this.isGlow5=!0,this.matchGlow5.setActive(!0),e?this.matchGlow5.explode(100):this.scene.time.delayedCall(300,(()=>this.matchGlow5.start()))}disableGlow(){var e;this.matchExplode3&&this.matchExplode3.stop(),this.matchGlow4&&this.matchGlow4.stop(),this.matchGlow5&&this.matchGlow5.stop(),null===(e=this.match4Tween)||void 0===e||e.destroy(),this.match4Tween=void 0,this.isGlow4=!1,this.isGlow5=!1}isGlowed4(){return this.isGlow4}isGlowed5(){return this.isGlow5}shake(){this.scene.tweens.add({targets:this,scale:0,ease:"bounce.inout",autoDestroy:!0,duration:50,onComplete:()=>{this.destroy()}})}wipe(e,t){this.enableGlow5(!0),"LEFT"==e?this.scene.tweens.add({targets:this,progress:1,x:this.x-15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0),this.disableGlow()}}):"RIGHT"==e?this.scene.tweens.add({targets:this,progress:1,x:this.x+15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0),this.disableGlow()}}):"UP"==e?this.scene.tweens.add({targets:this,progress:1,y:this.y-15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0),this.disableGlow()}}):"DOWN"==e&&this.scene.tweens.add({targets:this,progress:1,y:this.y+15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0),this.disableGlow()}})}}class r{constructor(e){this.scene=e,this.tilePool=[],this.tileGrid=[];for(let e=0;e<a.gridHeight;e++){this.tileGrid[e]=[];for(let t=0;t<a.gridWidth;t++)this.tileGrid[e][t]=this.addTile(t,e).setAlpha(0)}}returnItem(e){this.tilePool.push(e)}allocItem(){var e;if(this.tilePool.length>0)return null===(e=this.tilePool)||void 0===e?void 0:e.pop();throw new Error("Pool is empty")}addTile(e,t,i){const s=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];return new l({scene:this.scene,x:e*a.tileWidth+a.tileWidth/2,y:t*a.tileHeight+a.tileHeight/2,texture:"tiles",frame:s,delay:i})}revealTiles(){var e,t,i,s;let l=300;for(let r=a.gridHeight-1;r>=0;r--)for(let h=0;h<a.gridWidth;h++){const a=null===(e=this.tileGrid[r][h])||void 0===e?void 0:e.y;null===(t=this.tileGrid[r][h])||void 0===t||t.setY(-200),a&&(null===(i=this.tileGrid[r][h])||void 0===i||i.revealImageWithDelay(null===(s=this.tileGrid[r][h])||void 0===s?void 0:s.x,a,l)),l+=20}}reuseTile(e,t,i,s){const l=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];return e.setTexture("tiles",l).setAlpha(0),e.setPosition(t*a.tileWidth+a.tileWidth/2,-100),e.revealImageWithDelay(t*a.tileWidth+a.tileWidth/2,i*a.tileHeight+a.tileHeight/2,s),e}getTilePos(e,t){const i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(t===e[s][a]){i.x=a,i.y=s;break}return i}emitGlow4(e){var t,i,s,a;const l=e[0].x==e[1].x;for(const r of e){const e=r,h=this.getTilePos(this.tileGrid,e);-1!==h.x&&-1!==h.y&&(l?(h.x>0&&this.tileGrid[h.y][h.x-1]&&(this.returnItem(this.tileGrid[h.y][h.x-1]),null===(s=this.tileGrid[h.y][h.x-1])||void 0===s||s.setActive(!1).setAlpha(0),this.tileGrid[h.y][h.x-1]=void 0),h.x<7&&this.tileGrid[h.y][h.x+1]&&(this.returnItem(this.tileGrid[h.y][h.x+1]),null===(a=this.tileGrid[h.y][h.x+1])||void 0===a||a.setActive(!1).setAlpha(0),this.tileGrid[h.y][h.x+1]=void 0)):(h.y>0&&this.tileGrid[h.y-1][h.x]&&(this.returnItem(this.tileGrid[h.y-1][h.x]),null===(t=this.tileGrid[h.y-1][h.x])||void 0===t||t.setActive(!1).setAlpha(0),this.tileGrid[h.y-1][h.x]=void 0),h.y<7&&this.tileGrid[h.y+1][h.x]&&(this.returnItem(this.tileGrid[h.y+1][h.x]),null===(i=this.tileGrid[h.y+1][h.x])||void 0===i||i.setActive(!1).setAlpha(0),this.tileGrid[h.y+1][h.x]=void 0)))}for(const t of e)t.disableGlow()}emitGlow5(e,t){var i,s,a,l;const r=this.getTilePos(this.tileGrid,e);if(-1!==r.x&&-1!==r.y){for(let e=r.y-1;e>=0;e--)this.tileGrid[e][r.x]&&(null===(i=this.tileGrid[e][r.x])||void 0===i||i.wipe("UP",5*(r.y-1-e)),this.returnItem(this.tileGrid[e][r.x]),this.tileGrid[e][r.x]=void 0);for(let e=r.y+1;e<8;e++)this.tileGrid[e][r.x]&&(null===(s=this.tileGrid[e][r.x])||void 0===s||s.wipe("DOWN",5*(e-r.y)),this.returnItem(this.tileGrid[e][r.x]),this.tileGrid[e][r.x]=void 0);for(let e=r.x-1;e>=0;e--)this.tileGrid[r.y][e]&&(null===(a=this.tileGrid[r.y][e])||void 0===a||a.wipe("LEFT",5*(r.x-1-e)),this.returnItem(this.tileGrid[r.y][e]),this.tileGrid[r.y][e]=void 0);for(let e=r.x+1;e<8;e++)this.tileGrid[r.y][e]&&(null===(l=this.tileGrid[r.y][e])||void 0===l||l.wipe("RIGHT",5*(e-r.x)),this.returnItem(this.tileGrid[r.y][e]),this.tileGrid[r.y][e]=void 0)}for(const e of t)e.disableGlow()}removeMatch3(e,t){for(const t of e){const e=this.getTilePos(this.tileGrid,t);-1!==e.x&&-1!==e.y&&(t.setAlpha(0),t.enableExplode3(),this.returnItem(t),this.tileGrid[e.y][e.x]=void 0)}t()}removeMatch4(e,t){this.scene.add.tween({targets:[e[0],e[3],e[1]],x:e[2].x,y:e[2].y,duration:100,autoDestroy:!0,ease:"sine.in",onComplete:()=>{for(let t=0;t<4;t++){const i=e[t],s=this.getTilePos(this.tileGrid,i);2!=t&&-1!==s.x&&-1!==s.y&&(this.returnItem(i),this.tileGrid[s.y][s.x]=void 0)}e[2].enableGlow4(),t()}})}removeMatch5(e,t){this.scene.add.tween({targets:[e[0],e[1],e[3],e[4]],x:e[2].x,y:e[2].y,duration:100,autoDestroy:!0,ease:"sine.in",onComplete:()=>{for(let t=0;t<5;t++){const i=e[t],s=this.getTilePos(this.tileGrid,i);2!=t&&-1!==s.x&&-1!==s.y&&(this.returnItem(i),this.tileGrid[s.y][s.x]=void 0)}e[2].enableGlow5(),t()}})}static getMatches(e){const t=[];let i=[];for(const s of e){const e=s;i=[];for(let a=0;a<e.length;a++)a<e.length-2&&s[a]&&s[a+1]&&s[a+2]&&s[a].frame===s[a+1].frame&&s[a+1].frame===s[a+2].frame&&(i.length>0&&-1==i.indexOf(s[a])&&(t.push(i),i=[]),-1==i.indexOf(s[a])&&i.push(s[a]),-1==i.indexOf(s[a+1])&&i.push(s[a+1]),-1==i.indexOf(s[a+2])&&i.push(s[a+2]));i.length>0&&t.push(i)}for(let s=0;s<e.length;s++){const a=e[s];i=[];for(let l=0;l<a.length;l++)l<a.length-2&&e[l][s]&&e[l+1][s]&&e[l+2][s]&&e[l][s].frame===e[l+1][s].frame&&e[l+1][s].frame===e[l+2][s].frame&&(i.length>0&&-1==i.indexOf(e[l][s])&&(t.push(i),i=[]),-1==i.indexOf(e[l][s])&&i.push(e[l][s]),-1==i.indexOf(e[l+1][s])&&i.push(e[l+1][s]),-1==i.indexOf(e[l+2][s])&&i.push(e[l+2][s]));i.length>0&&t.push(i)}return t}static emitSuggestion(e,t,i){e.y==t.y?(e.getAttracted("RIGHT"),t.getAttracted("LEFT")):(e.getAttracted("DOWN"),t.getAttracted("UP")),i()}}class h extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e)}update(e,t,i){const s=super.update(e,t,i);return this.accelerationY=-this.velocityY,this.accelerationX=-2*this.velocityX,s}}class o{constructor(e){this.scene=e,this.confettiParticle=e.add.particles(0,585,"confetti",{frame:{frames:["blue.png","green.png","red.png"],cycle:!0},lifespan:5e3,speed:{min:650,max:1200},angle:{min:-60,max:-50},scale:{start:.3,end:0},gravityY:300,emitting:!1,frequency:60,quantity:5,particleClass:h,collideBottom:!0}),this.matchParticle=e.add.particles(0,0,"flares",{frame:{frames:["red","green","blue"],cycle:!0},lifespan:500,emitting:!1,scale:{start:.5,end:.1},duration:500}),this.explodeParticle=e.add.particles(0,0,"flare",{speed:24,lifespan:1500,quantity:10,scale:{start:.3,end:0},emitting:!1,duration:300}),this.match3x3Particle=e.add.particles(0,0,"flares",{frame:{frames:["red","green","blue"],cycle:!0},lifespan:250,emitting:!1,scale:{start:.5,end:.1},duration:300})}emitGlow4(e){const t=new Phaser.Geom.Rectangle(e[1].x-3*e[0].width/2,e[1].y-3*e[0].height/2,3*e[0].width,3*e[0].height),i=this.explodeParticle.addEmitZone({type:"edge",source:t,quantity:22});this.explodeParticle.start(0,300),this.scene.time.delayedCall(300,(()=>{this.explodeParticle.removeEmitZone(i[0])}))}emitLineToScoreboard(e){const t=new Phaser.Geom.Line(0,0,520-e[0].x,100-e[0].y);this.match3x3Particle.setPosition(e[0].x,e[0].y);const i=this.match3x3Particle.addEmitZone({type:"edge",source:t,quantity:32,total:1});this.match3x3Particle.start(300),this.scene.time.delayedCall(500,(()=>{this.match3x3Particle.removeEmitZone(i[0])}))}stopMatchParticle(e){this.matchParticle.stop(!0),e?this.matchParticle.setAlpha(0):this.matchParticle.setAlpha(1)}emitConfetti(e){this.confettiParticle.explode(e)}}class n extends Phaser.Renderer.WebGL.Pipelines.MultiPipeline{constructor(e){super({game:e,fragShader:"\n            precision mediump float;\n            \n            uniform sampler2D uMainSampler[%count%];\n            uniform float a;\n            \n            varying vec2 outTexCoord;\n            varying float outTexId;\n            varying vec4 outTint;\n            varying vec2 fragCoord;\n            \n            void main()\n            {\n                vec4 texture;\n            \n                %forloop%\n            \n                gl_FragColor = texture;\n                gl_FragColor.rgb = mix(gl_FragColor.rgb,vec3(0.2126 * gl_FragColor.r + 0.7152 * gl_FragColor.g + 0.0722 * gl_FragColor.b),a);\n            }\n            "})}onPreRender(){this.set1f("a",1)}}class d{static addStats(e){e.stats=document.createElement("span"),e.stats.style.position="fixed",e.stats.style.left="0",e.stats.style.bottom="0",e.stats.style.backgroundColor="black",e.stats.style.minWidth="200px",e.stats.style.padding="15px",e.stats.style.color="white",e.stats.style.fontFamily="Courier New",e.stats.style.textAlign="center",e.stats.innerText="Draw calls: ?",document.body.append(e.stats)}static countDrawCalls(e){const t=e.game.renderer;if(t instanceof Phaser.Renderer.WebGL.WebGLRenderer){let i=0;const s=t.pipelines.pipelines.values();t.on(Phaser.Renderer.Events.PRE_RENDER,(()=>i=0)),s.forEach((e=>e.on(Phaser.Renderer.WebGL.Pipelines.Events.AFTER_FLUSH,(()=>i++)))),t.on(Phaser.Renderer.Events.POST_RENDER,(()=>d.redrawStats(e,i)))}else t.on(Phaser.Renderer.Events.POST_RENDER,(()=>d.redrawStats(e,t.drawCount)))}static redrawStats(e,t=0){e.stats.innerText=`Draw calls: ${t}`}}class c extends Phaser.Scene{constructor(){super({key:"GameScene"})}enablePipeline(){this.game.renderer.pipelines.add("Custom",new n(this.game)).set2f("uResolution",this.game.config.width,this.game.config.height)}init(){d.addStats(this),d.countDrawCalls(this),this.enablePipeline(),this.tileManager=new r(this),this.particleManager=new o(this),this.canMove=!0,this.isSuggested=!1,this.isRedisting=!1,this.isRemoving=!1,this.cameras.main.setBackgroundColor(9805),this.scoreText=this.add.text(-100,-100,"100",{fontSize:"24px",color:"#fff",fontStyle:"bold"}).setDepth(2),this.tileGrid=this.tileManager.tileGrid,this.tileManager.revealTiles(),this.time.delayedCall(2e3,(()=>{this.checkMatches()})),this.input.on("gameobjectdown",this.tileDown,this),this.createTimerEvent()}createTimerEvent(){this.suggestionEvent=new Phaser.Time.TimerEvent({delay:1500}),this.idleEvent=new Phaser.Time.TimerEvent({delay:5e3}),this.time.addEvent(this.suggestionEvent),this.time.addEvent(this.idleEvent),this.input.on("pointerdown",(()=>{this.time.addEvent(this.suggestionEvent),this.time.addEvent(this.idleEvent),this.particleManager.matchParticle&&(this.particleManager.matchParticle.stop(),this.isSuggested=!1)}),this)}update(){1==this.suggestionEvent.getProgress()&&(this.getNextMove((()=>this.shuffle())),this.time.addEvent(this.suggestionEvent)),1==this.idleEvent.getProgress()&&(this.idle(),this.time.addEvent(this.idleEvent))}tileDown(e,t,i){if(this.canMove)if(null==this.firstSelectedTile)this.firstSelectedTile=t,this.firstSelectedTile.getSelected();else{if(this.firstSelectedTile.getDeselected(),this.firstSelectedTile==t)return void(this.firstSelectedTile=void 0);this.secondSelectedTile=t,this.secondSelectedTile&&(Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x),Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y),this.canMove=!1,this.swapTiles())}}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.canMove=!1;const e={x:this.firstSelectedTile.x-a.tileWidth/2,y:this.firstSelectedTile.y-a.tileHeight/2},t={x:this.secondSelectedTile.x-a.tileWidth/2,y:this.secondSelectedTile.y-a.tileHeight/2};this.tileGrid[Math.floor(e.y/a.tileHeight)][e.x/a.tileWidth]=this.secondSelectedTile,this.tileGrid[Math.floor(t.y/a.tileHeight)][t.x/a.tileWidth]=this.firstSelectedTile,this.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,ease:"cubic.inout",duration:600,repeat:0,yoyo:!1,autoDestroy:!0}),this.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,ease:"cubic.inout",duration:600,repeat:0,yoyo:!1,onComplete:()=>{this.checkMatches(),this.canMove=!0},autoDestroy:!0}),this.firstSelectedTile=this.tileGrid[Math.floor(e.y/a.tileHeight)][e.x/a.tileWidth],this.secondSelectedTile=this.tileGrid[Math.floor(t.y/a.tileHeight)][t.x/a.tileWidth]}}checkMatches(){const e=r.getMatches(this.tileGrid);e.length>0&&!this.isRemoving?this.removeTileGroup(e,(()=>this.time.delayedCall(300,(()=>{this.resetTile((()=>{this.fillTile((()=>this.time.delayedCall(300,(()=>{this.tileUp((()=>{this.checkMatches()}))}))))}))})))):this.tileUp((()=>{this.canMove=!0}))}resetTile(e){for(let e=0;e<this.tileGrid.length;e++)for(let t=this.tileGrid[e].length-1;t>0;t--)if(void 0===this.tileGrid[t][e]&&void 0!==this.tileGrid[t-1][e]){const i=this.tileGrid[t-1][e];this.tileGrid[t][e]=i,this.tileGrid[t-1][e]=void 0,this.add.tween({targets:i,y:a.tileHeight*t+a.tileHeight/2,ease:"sine.inout",duration:100,repeat:0,yoyo:!1,autoDestroy:!0}),e=-1;break}e()}fillTile(e){let t=!1;this.canMove=!1;for(let e=0;e<this.tileGrid.length;e++)for(let i=0;i<this.tileGrid[e].length;i++)if(void 0===this.tileGrid[e][i]){const s=this.tileManager.allocItem();if(s){const a=this.tileManager.reuseTile(s,i,e,100);this.tileGrid[e][i]=a,t=!0}}this.canMove=!0,this.time.delayedCall(1e3,(()=>{t&&(this.particleManager.stopMatchParticle(!0),this.isSuggested=!1),this.canMove=!0})),e()}tileUp(e){this.secondSelectedTile&&(this.firstSelectedTile=void 0,this.secondSelectedTile=void 0),e()}removeTileGroup(e,t){this.isRemoving=!0;for(const t of e){this.emitScoreText(t);let[e,i]=[void 0,void 0];for(const e of t)e.isGlowed5()&&(i=e);if(!i)for(const i of t)i.isGlowed4()&&(e=i);e?(this.particleManager.emitGlow4(t),this.tileManager.emitGlow4(t)):i&&this.tileManager.emitGlow5(i,t),this.particleManager.emitLineToScoreboard(t),this.removeByMatch(t)}t()}removeByMatch(e){switch(e.length){case 3:this.tileManager.removeMatch3(e,(()=>{this.isRemoving=!1}));break;case 4:this.tileManager.removeMatch4(e,(()=>{this.isRemoving=!1}));break;case 5:this.tileManager.removeMatch5(e,(()=>{this.isRemoving=!1}))}}idle(){let e=0;for(let t=0;t<this.tileGrid.length;t++)for(const i of this.tileGrid)null!=i[t]&&(this.idleTweens=this.add.tween({targets:i[t],scale:.5,ease:"sine.inout",duration:300,autoDestroy:!0,delay:50*e,repeat:2,yoyo:!0}),e++,e%8==0&&(e=0))}getNextMove(e){const[t,i]=[this.tileGrid,this.tileGrid.length],s=[[1,0],[-1,0],[0,1],[0,-1]];if(!this.isSuggested&&this.canMove){let a=!1;this.resetTile((()=>{for(let e=0;e<i;e++)for(let l=0;l<i;l++)if(void 0!==t[e][l])for(const[h,o]of s){const s=e+h,n=l+o;if(s>=0&&s<i&&n>=0&&n<i&&void 0!==t[s][n]){if([t[e][l],t[s][n]]=[t[s][n],t[e][l]],r.getMatches(t).length>0)return[t[e][l],t[s][n]]=[t[s][n],t[e][l]],void(!this.isSuggested&&this.canMove&&(this.canMove=!1,r.emitSuggestion(t[e][l],t[s][n],(()=>this.canMove=!0)),this.isSuggested=!0));[t[e][l],t[s][n]]=[t[s][n],t[e][l]],e==i-1&&l==i-1&&(a=!0)}}})),this.canMove&&!this.isRedisting&&a&&(this.canMove=!1,this.tileUp((()=>{this.time.delayedCall(800,(()=>{e()}))})))}}emitScoreText(e){this.scoreText.setPosition(e[1].x-20,e[1].y-5);const t=e.length;this.scoreText.setText(a.matchScore[t]),this.scoreText.setAlpha(1),this.add.tween({targets:this,alpha:0,duration:500,ease:"sine.inout",autoDestroy:!0,onStart:()=>{this.canMove=!1},onComplete:()=>{this.registry.values.score+=parseInt(a.matchScore[t]),this.scoreText.setAlpha(0),this.events.emit("scoreChanged"),(this.registry.values.score%a.milestone==0&&this.registry.values.score>0||this.registry.get("score")>this.registry.get("level")*a.milestone)&&(this.particleManager.stopMatchParticle(!0),this.isSuggested=!0,this.particleManager.emitConfetti(128),this.tileUp((()=>{this.time.delayedCall(1200,(()=>{this.canMove&&!this.isRedisting&&this.shuffle()}))})),this.canMove=!0)}})}shuffle(){if(!this.isRedisting){this.particleManager.stopMatchParticle(!0),this.isRedisting=!0,this.canMove=!1;const e=this.tileGrid.flat().filter((e=>null!=e)),t=a.shape[Phaser.Math.RND.between(0,a.shape.length-1)],i=this.createPattern(e,t);this.add.tween({targets:i,radius:150,ease:"sine.inout",delay:300,duration:600,yoyo:!0,autoDestroy:!0,onStart:()=>{this.particleManager.stopMatchParticle(!0)},onUpdate:()=>this.onUpdateShuffle(e,i),onComplete:()=>this.onCompleteShuffle()})}}moveTilesByPattern(e){if(e instanceof Phaser.Geom.Polygon){const t=Phaser.Geom.Polygon.GetPoints(e,a.gridHeight*a.gridWidth);console.log(t);for(let e=0;e<a.gridHeight;e++)for(let i=0;i<a.gridWidth;i++)this.tweens.add({targets:this.tileGrid[e][i],x:t[e*a.gridHeight+i].x,y:t[e*a.gridHeight+i].y,duration:300,ease:"cubic.out"})}}createPattern(e,t){let i;return i="hexagon"===t?new Phaser.Geom.Polygon(a.hexagon):"flower1"===t?new Phaser.Geom.Polygon(a.flower1):"flower2"===t?new Phaser.Geom.Polygon(a.flower2):"butterfly"===t?new Phaser.Geom.Polygon(a.butterfly):new Phaser.Geom.Polygon(a.infinity),this.moveTilesByPattern(i),i}onUpdateShuffle(e,t){for(let t=0;t<e.length;t++)this.tweens.add({targets:e[t],x:e[(t+1)%e.length].x,y:e[(t+1)%e.length].y,duration:20})}onCompleteShuffle(){var e,t;this.isRedisting=!1,this.time.addEvent(this.idleEvent),this.time.addEvent(this.suggestionEvent);let i=200;for(let s=0;s<a.gridHeight;s++)for(let l=0;l<a.gridWidth;l++){const r=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];null===(e=this.tileGrid[s][l])||void 0===e||e.setTexture("tiles",r),null===(t=this.tileGrid[s][l])||void 0===t||t.revealImageWithDelay(l*a.tileWidth+a.tileWidth/2,s*a.tileHeight+a.tileHeight/2,i),i+=10}this.isSuggested=!0,this.canMove=!0,this.time.delayedCall(2e3,(()=>{this.checkMatches(),this.particleManager.stopMatchParticle(!1),this.isSuggested=!1}))}}class g extends Phaser.Scene{constructor(){super({key:"HUDScene"})}create(){this.target=a.milestone,this.createLoadingbar(),this.progressParticle=this.add.particles(523,157.5,"flares",{y:{min:-5,max:5},frame:"white",color:[6923985,9756671,13233135],lifespan:800,angle:{min:90,max:270},scale:{start:.07,end:0,ease:"sine.in"},speed:{min:20,max:30},blendMode:"NORMAL",quantity:3}).setAlpha(0).setDepth(2),this.textElements=new Map([["TARGET",this.addText(520,8,"Goal: "+this.registry.get("level")*a.milestone)],["LEVEL",this.addText(520,48,`Level: ${this.registry.get("level")}`)],["SCORE",this.addText(520,88,`Score: ${this.registry.get("score")}`)]]);const e=this.scene.get("GameScene");e.events.on("scoreChanged",this.updateScore,this),e.events.on("levelChanged",this.updateLevel,this)}addText(e,t,i){return this.add.bitmapText(e,t,"font",i,35)}updateProgress(){this.tweens.add({targets:this.progressBar,width:228*this.registry.get("score")/this.target,duration:200,ease:"sine.inout",onComplete:()=>{this.progressParticle.setAlpha(1),this.progressParticle.setX(528+180*this.registry.get("score")/this.target)}})}updateScore(){var e;null===(e=this.textElements.get("SCORE"))||void 0===e||e.setText(`Score: ${this.registry.get("score")}`),this.updateProgress(),!this.textLock&&this.registry.get("score")%a.milestone==0&&this.registry.get("score")>0||this.registry.get("score")>this.registry.get("level")*a.milestone?(this.registry.values.level+=1,this.textLock=!0,this.updateLevel(),this.updateScore(),this.progressParticle.setAlpha(0)):this.textLock=!1}updateLevel(){var e,t,i;null===(e=this.textElements.get("LEVEL"))||void 0===e||e.setAlpha(0),this.target+=a.milestone,null===(t=this.textElements.get("TARGET"))||void 0===t||t.setText(`Goal: ${this.target}`),null===(i=this.textElements.get("LEVEL"))||void 0===i||i.setAlpha(1).setText(`Level: ${this.registry.get("level")}`),this.updateProgress()}createLoadingbar(){this.loadingBar=this.add.nineslice(520,160,"ui","ButtonOrange"),this.progressBar=this.add.nineslice(528,158,"ui","ButtonOrangeFill1",0,16,6,6),this.loadingBar.setOrigin(0,.5).setScale(.75,.6).setDepth(1),this.progressBar.setOrigin(0,.5).setScale(.75,.6).setDepth(3)}}const p={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",width:715,height:575,type:Phaser.WEBGL,parent:"game",scene:[s,c,g],scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},backgroundColor:"#ffd1dc",render:{pixelArt:!1,antialias:!0},fps:{target:60,forceSetTimeOut:!0},clearBeforeRender:!1,powerPreference:"high-performance",batchSize:1024};class u extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new u(p)}))}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var l=i[e]={exports:{}};return t[e].call(l.exports,l,l.exports,s),l.exports}s.m=t,e=[],s.O=(t,i,a,l)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){for(var[i,a,l]=e[d],h=!0,o=0;o<i.length;o++)(!1&l||r>=l)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(h=!1,l<r&&(r=l));if(h){e.splice(d--,1);var n=a();void 0!==n&&(t=n)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[i,a,l]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,l,[r,h,o]=i,n=0;if(r.some((t=>0!==e[t]))){for(a in h)s.o(h,a)&&(s.m[a]=h[a]);if(o)var d=o(s)}for(t&&t(i);n<r.length;n++)l=r[n],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[216],(()=>s(790)));a=s.O(a)})();