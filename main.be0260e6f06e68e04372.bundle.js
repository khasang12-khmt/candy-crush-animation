(()=>{"use strict";var e,t={431:(e,t,i)=>{i(260);class s extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.atlas("flares","assets/particles/flares.png","assets/particles/flares.json"),this.load.atlas("confetti","assets/particles/confetti.png","assets/particles/confetti.json"),this.load.atlas("ui","assets/ui/nine-slice.png","assets/ui/nine-slice.json"),this.load.image("flare","assets/particles/white-flare.png"),this.load.atlas("tiles","assets/images/tiles.png","assets/images/tiles.json")}init(){this.registry.set("level",1),this.registry.set("score",0)}update(){this.scene.start("HUDScene"),this.scene.start("GameScene"),this.scene.bringToTop("HUDScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const a={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,milestone:2e3,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"],shape:["triangle","rectangle","circle"],matchScore:["0","0","0","100","200","300","400","500"],triangle:[255,87.5,255-200*Math.cos(Math.PI/6),287.5+200*Math.sin(Math.PI/6),255+200*Math.cos(Math.PI/6),287.5+200*Math.sin(Math.PI/6)],circle:[300,400,200],rectangle:[255-200*Math.cos(Math.PI/4),287.5-200*Math.sin(Math.PI/4),400*Math.cos(Math.PI/4),400*Math.cos(Math.PI/4)]};class l extends Phaser.GameObjects.Sprite{constructor(e){if(super(e.scene,e.x,e.y,e.texture,e.frame),this.setOrigin(.5,.5),this.setScale(.8),this.setInteractive(),e.delay){const t=this.y;this.y=t-this.height,this.scene.tweens.add({targets:this,y:t,ease:"Power3",autoDestroy:!0,duration:200,delay:e.delay})}this.scene.add.existing(this)}revealImageWithDelay(e,t,i){this.scene.tweens.add({targets:this,x:e,y:t,alpha:1,ease:"Power3",autoDestroy:!0,duration:400,delay:i})}getSelected(){if(!this.selectedShader){const e=new Phaser.Display.BaseShader("BufferShader2",r);this.selectedShader=this.scene.add.shader(e,this.x-5,this.y,1.2*this.width,1.2*this.height).setDepth(-1).setActive(!1).setVisible(!1)}this.selectedShader.setX(this.x-5),this.selectedShader.setY(this.y),this.selectedShader.setActive(!0).setVisible(!0)}getDeselected(){this.selectedShader.setActive(!1).setVisible(!1)}getAttracted(e){let t;"LEFT"==e?t={x:this.x-10}:"RIGHT"==e?t={x:this.x+10}:"UP"==e?t={y:this.y-10}:"DOWN"==e&&(t={y:this.y+10}),this.suggestedTween||(this.suggestedTween=this.scene.tweens.add({targets:this,yoyo:!0,ease:"sine.in",autoDestroy:!0,repeat:0,duration:500,onComplete:()=>{var e;null===(e=this.suggestedTween)||void 0===e||e.stop(),this.suggestedTween=void 0,this.setAlpha(1)},scale:.9}))}enableExplode3(){this.matchExplode3||(this.matchExplode3=this.scene.add.particles(this.x,this.y,"flare",{speed:50,advance:20,duration:100,lifespan:250,scale:.5,emitting:!1,maxAliveParticles:5,delay:20}).setActive(!1).startFollow(this,-this.x,-this.y)),this.matchExplode3.setActive(!0),this.matchExplode3.start()}enableGlow4(){this.matchGlow4||(this.matchGlow4=this.scene.add.particles(this.x,this.y,"flares",{frame:"white",color:[16436258,16291840,16266752,10421252],colorEase:"quad.out",lifespan:500,angle:{min:-0,max:-360},scale:{start:.5,end:0,ease:"sine.out"},speed:100,blendMode:"NORMAL",emitting:!1}).setActive(!1).setDepth(-1).startFollow(this,-this.x,-this.y)),this.isGlow4=!0,this.matchGlow4.setActive(!0),this.scene.time.delayedCall(300,(()=>this.matchGlow4.start()))}enableGlow5(){this.matchGlow5||(this.matchGlow5=this.scene.add.particles(this.x,this.y,"flares",{frame:"white",color:[9887962,9666291],colorEase:"quart.out",lifespan:500,angle:[0,90,180,270],scale:{start:.5,end:0,ease:"sine.in"},speed:100,blendMode:"NORMAL",emitting:!1}).setActive(!1).setDepth(-1).startFollow(this,-this.x,-this.y)),this.isGlow5=!0,this.matchGlow5.setActive(!0),this.scene.time.delayedCall(300,(()=>this.matchGlow5.start()))}disableGlow(){var e;this.matchExplode3&&this.matchExplode3.stop(),this.matchGlow4&&this.matchGlow4.stop(),this.matchGlow5&&this.matchGlow5.stop(),null===(e=this.match4Tween)||void 0===e||e.destroy(),this.match4Tween=void 0,this.isGlow4=!1,this.isGlow5=!1}isGlowed4(){return this.isGlow4}isGlowed5(){return this.isGlow5}shake(){this.scene.tweens.add({targets:this,scale:0,ease:"bounce.inout",autoDestroy:!0,duration:50,onComplete:()=>{this.destroy()}})}wipe(e,t){"LEFT"==e?this.scene.tweens.add({targets:this,progress:1,x:this.x-15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}}):"RIGHT"==e?this.scene.tweens.add({targets:this,progress:1,x:this.x+15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}}):"UP"==e?this.scene.tweens.add({targets:this,progress:1,y:this.y-15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}}):"DOWN"==e&&this.scene.tweens.add({targets:this,progress:1,y:this.y+15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}})}}const r="\nprecision mediump float;\n\nuniform float time;\nuniform vec2 resolution;\nuniform vec2 mouse;\n\nvarying vec2 fragCoord;\n\nvoid main (void)\n{\n    float intensity = 0.;\n\n    for (float i = 0.; i < 54.; i++)\n    {\n        float angle = i/27. * 3.14159;\n        vec2 xy = vec2(0.27 * cos(angle), 0.27 * sin(angle));\n        xy += fragCoord.xy/resolution.y-0.5;\n        intensity += pow(1000000., (0.77 - length(xy) * 1.9) * (1. + 0.275 * fract(-i / 27. - time))) / 80000.;\n    }\n\n    gl_FragColor = vec4(clamp(intensity * vec3(0.0927, 0.396, 0.17), vec3(0.), vec3(0.5)), 0.);\n}\n";class h{constructor(e){this.scene=e,this.tilePool=[],this.tileGrid=[];for(let e=0;e<a.gridHeight;e++){this.tileGrid[e]=[];for(let t=0;t<a.gridWidth;t++)this.tileGrid[e][t]=this.addTile(t,e).setAlpha(0)}}returnItem(e){this.tilePool.push(e)}allocItem(){var e;if(this.tilePool.length>0)return null===(e=this.tilePool)||void 0===e?void 0:e.pop();throw new Error("Pool is empty")}addTile(e,t,i){const s=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];return new l({scene:this.scene,x:e*a.tileWidth+a.tileWidth/2,y:t*a.tileHeight+a.tileHeight/2,texture:"tiles",frame:s,delay:i})}revealTiles(){var e,t,i,s;let l=300;for(let r=a.gridHeight-1;r>=0;r--)for(let h=0;h<a.gridWidth;h++){const a=null===(e=this.tileGrid[r][h])||void 0===e?void 0:e.y;null===(t=this.tileGrid[r][h])||void 0===t||t.setY(-200),a&&(null===(i=this.tileGrid[r][h])||void 0===i||i.revealImageWithDelay(null===(s=this.tileGrid[r][h])||void 0===s?void 0:s.x,a,l)),l+=20}}reuseTile(e,t,i,s){const l=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];return e.setTexture("tiles",l).setAlpha(0),e.setPosition(t*a.tileWidth+a.tileWidth/2,-100),e.revealImageWithDelay(t*a.tileWidth+a.tileWidth/2,i*a.tileHeight+a.tileHeight/2,s),e}getTilePos(e,t){const i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(t===e[s][a]){i.x=a,i.y=s;break}return i}emitGlow4(e){var t,i,s,a;const l=e[0].x==e[1].x;for(const r of e){const e=r,h=this.getTilePos(this.tileGrid,e);-1!==h.x&&-1!==h.y&&(l?(h.x>0&&this.tileGrid[h.y][h.x-1]&&(this.returnItem(this.tileGrid[h.y][h.x-1]),null===(s=this.tileGrid[h.y][h.x-1])||void 0===s||s.setActive(!1).setAlpha(0),this.tileGrid[h.y][h.x-1]=void 0),h.x<7&&this.tileGrid[h.y][h.x+1]&&(this.returnItem(this.tileGrid[h.y][h.x+1]),null===(a=this.tileGrid[h.y][h.x+1])||void 0===a||a.setActive(!1).setAlpha(0),this.tileGrid[h.y][h.x+1]=void 0)):(h.y>0&&this.tileGrid[h.y-1][h.x]&&(this.returnItem(this.tileGrid[h.y-1][h.x]),null===(t=this.tileGrid[h.y-1][h.x])||void 0===t||t.setActive(!1).setAlpha(0),this.tileGrid[h.y-1][h.x]=void 0),h.y<7&&this.tileGrid[h.y+1][h.x]&&(this.returnItem(this.tileGrid[h.y+1][h.x]),null===(i=this.tileGrid[h.y+1][h.x])||void 0===i||i.setActive(!1).setAlpha(0),this.tileGrid[h.y+1][h.x]=void 0)))}for(const t of e)t.disableGlow()}emitGlow5(e,t){var i,s,a,l;const r=this.getTilePos(this.tileGrid,e);if(-1!==r.x&&-1!==r.y){for(let e=r.y-1;e>=0;e--)this.tileGrid[e][r.x]&&(null===(i=this.tileGrid[e][r.x])||void 0===i||i.wipe("UP",5*(r.y-1-e)),this.returnItem(this.tileGrid[e][r.x]),this.tileGrid[e][r.x]=void 0);for(let e=r.y+1;e<8;e++)this.tileGrid[e][r.x]&&(null===(s=this.tileGrid[e][r.x])||void 0===s||s.wipe("DOWN",5*(e-r.y)),this.returnItem(this.tileGrid[e][r.x]),this.tileGrid[e][r.x]=void 0);for(let e=r.x-1;e>=0;e--)this.tileGrid[r.y][e]&&(null===(a=this.tileGrid[r.y][e])||void 0===a||a.wipe("LEFT",5*(r.x-1-e)),this.returnItem(this.tileGrid[r.y][e]),this.tileGrid[r.y][e]=void 0);for(let e=r.x+1;e<8;e++)this.tileGrid[r.y][e]&&(null===(l=this.tileGrid[r.y][e])||void 0===l||l.wipe("RIGHT",5*(e-r.x)),this.returnItem(this.tileGrid[r.y][e]),this.tileGrid[r.y][e]=void 0)}for(const e of t)e.disableGlow()}removeMatch3(e,t){for(const t of e){const e=this.getTilePos(this.tileGrid,t);-1!==e.x&&-1!==e.y&&(t.setAlpha(0),t.enableExplode3(),this.returnItem(t),this.tileGrid[e.y][e.x]=void 0)}t()}removeMatch4(e,t){this.scene.add.tween({targets:[e[0],e[3],e[1]],x:e[2].x,y:e[2].y,duration:100,autoDestroy:!0,ease:"sine.in",onComplete:()=>{for(let t=0;t<4;t++){const i=e[t],s=this.getTilePos(this.tileGrid,i);2!=t&&-1!==s.x&&-1!==s.y&&(this.returnItem(i),this.tileGrid[s.y][s.x]=void 0)}e[2].enableGlow4(),t()}})}removeMatch5(e,t){this.scene.add.tween({targets:[e[0],e[1],e[3],e[4]],x:e[2].x,y:e[2].y,duration:100,autoDestroy:!0,ease:"sine.in",onComplete:()=>{for(let t=0;t<5;t++){const i=e[t],s=this.getTilePos(this.tileGrid,i);2!=t&&-1!==s.x&&-1!==s.y&&(this.returnItem(i),this.tileGrid[s.y][s.x]=void 0)}e[2].enableGlow5(),t()}})}static getMatches(e){const t=[];let i=[];for(const s of e){const e=s;i=[];for(let a=0;a<e.length;a++)a<e.length-2&&s[a]&&s[a+1]&&s[a+2]&&s[a].frame===s[a+1].frame&&s[a+1].frame===s[a+2].frame&&(i.length>0&&-1==i.indexOf(s[a])&&(t.push(i),i=[]),-1==i.indexOf(s[a])&&i.push(s[a]),-1==i.indexOf(s[a+1])&&i.push(s[a+1]),-1==i.indexOf(s[a+2])&&i.push(s[a+2]));i.length>0&&t.push(i)}for(let s=0;s<e.length;s++){const a=e[s];i=[];for(let l=0;l<a.length;l++)l<a.length-2&&e[l][s]&&e[l+1][s]&&e[l+2][s]&&e[l][s].frame===e[l+1][s].frame&&e[l+1][s].frame===e[l+2][s].frame&&(i.length>0&&-1==i.indexOf(e[l][s])&&(t.push(i),i=[]),-1==i.indexOf(e[l][s])&&i.push(e[l][s]),-1==i.indexOf(e[l+1][s])&&i.push(e[l+1][s]),-1==i.indexOf(e[l+2][s])&&i.push(e[l+2][s]));i.length>0&&t.push(i)}return t}static emitSuggestion(e,t,i){e.y==t.y?(e.getAttracted("RIGHT"),t.getAttracted("LEFT")):(e.getAttracted("DOWN"),t.getAttracted("UP")),i()}}class n extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e)}update(e,t,i){const s=super.update(e,t,i);return this.accelerationY=-this.velocityY,this.accelerationX=-2*this.velocityX,s}}class o{constructor(e){this.scene=e,this.confettiParticle=e.add.particles(0,585,"confetti",{frame:{frames:["blue.png","green.png","red.png"],cycle:!0},lifespan:5e3,speed:{min:650,max:1200},angle:{min:-60,max:-50},scale:{start:.3,end:0},gravityY:300,emitting:!1,frequency:60,quantity:5,particleClass:n,collideBottom:!0}),this.matchParticle=e.add.particles(0,0,"flares",{frame:{frames:["red","green","blue"],cycle:!0},lifespan:500,emitting:!1,scale:{start:.5,end:.1},duration:500}),this.explodeParticle=e.add.particles(0,0,"flare",{speed:24,lifespan:1500,quantity:10,scale:{start:.3,end:0},emitting:!1,duration:300}),this.match3x3Particle=e.add.particles(0,0,"flares",{frame:{frames:["red","green","blue"],cycle:!0},lifespan:250,emitting:!1,scale:{start:.5,end:.1},duration:300})}emitGlow4(e){const t=new Phaser.Geom.Rectangle(e[1].x-3*e[0].width/2,e[1].y-3*e[0].height/2,3*e[0].width,3*e[0].height),i=this.explodeParticle.addEmitZone({type:"edge",source:t,quantity:22});this.explodeParticle.start(0,300),this.scene.time.delayedCall(300,(()=>{this.explodeParticle.removeEmitZone(i[0])}))}emitLineToScoreboard(e){const t=new Phaser.Geom.Line(0,0,520-e[0].x,100-e[0].y);this.match3x3Particle.setPosition(e[0].x,e[0].y);const i=this.match3x3Particle.addEmitZone({type:"edge",source:t,quantity:32,total:1});this.match3x3Particle.start(300),this.scene.time.delayedCall(500,(()=>{this.match3x3Particle.removeEmitZone(i[0])}))}stopMatchParticle(e){this.matchParticle.stop(!0),e?this.matchParticle.setAlpha(0):this.matchParticle.setAlpha(1)}emitConfetti(e){this.confettiParticle.explode(e)}}class c extends Phaser.Renderer.WebGL.Pipelines.MultiPipeline{constructor(e){super({game:e,fragShader:"\n            precision mediump float;\n\n            uniform sampler2D uMainSampler[%count%];\n            uniform vec2 uResolution;\n            uniform float uTime;\n\n            varying vec2 outTexCoord;\n            varying float outTexId;\n            varying vec4 outTint;\n\n            vec4 plasma()\n            {\n                vec2 pixelPos = gl_FragCoord.xy / uResolution * 20.0;\n                float freq = 0.8;\n                float value =\n                    sin(uTime + pixelPos.x * freq) +\n                    sin(uTime + pixelPos.y * freq) +\n                    sin(uTime + (pixelPos.x + pixelPos.y) * freq) +\n                    cos(uTime + sqrt(length(pixelPos - 0.5)) * freq * 2.0);\n\n                return vec4(\n                    cos(value),\n                    sin(value),\n                    sin(value * 3.14 * 2.0),\n                    cos(value)\n                );\n            }\n\n            void main()\n            {\n                vec4 texture;\n\n                %forloop%\n\n                texture *= vec4(outTint.rgb * outTint.a, outTint.a);\n\n                gl_FragColor = texture * plasma();\n            }\n            "})}}class d{static addStats(e){e.stats=document.createElement("span"),e.stats.style.position="fixed",e.stats.style.left="0",e.stats.style.bottom="0",e.stats.style.backgroundColor="black",e.stats.style.minWidth="200px",e.stats.style.padding="15px",e.stats.style.color="white",e.stats.style.fontFamily="Courier New",e.stats.style.textAlign="center",e.stats.innerText="Draw calls: ?",document.body.append(e.stats)}static countDrawCalls(e){const t=e.game.renderer;if(t instanceof Phaser.Renderer.WebGL.WebGLRenderer){let i=0;const s=t.pipelines.pipelines.values();t.on(Phaser.Renderer.Events.PRE_RENDER,(()=>i=0)),s.forEach((e=>e.on(Phaser.Renderer.WebGL.Pipelines.Events.AFTER_FLUSH,(()=>i++)))),t.on(Phaser.Renderer.Events.POST_RENDER,(()=>d.redrawStats(e,i)))}else t.on(Phaser.Renderer.Events.POST_RENDER,(()=>d.redrawStats(e,t.drawCount)))}static redrawStats(e,t=0){e.stats.innerText=`Draw calls: ${t}`}}class g extends Phaser.Scene{constructor(){super({key:"GameScene"})}enablePipeline(){this.game.renderer.pipelines.add("Custom",new c(this.game)).set2f("uResolution",this.game.config.width,this.game.config.height)}init(){d.addStats(this),d.countDrawCalls(this),this.tileManager=new h(this),this.particleManager=new o(this),this.canMove=!0,this.isSuggested=!1,this.isRedisting=!1,this.isRemoving=!1,this.cameras.main.setBackgroundColor(9805),this.scoreText=this.add.text(-100,-100,"100",{fontSize:"24px",color:"#fff",fontStyle:"bold"}).setDepth(2),this.tileGrid=this.tileManager.tileGrid,this.tileManager.revealTiles(),this.time.delayedCall(2e3,(()=>{this.checkMatches()})),this.input.on("gameobjectdown",this.tileDown,this),this.input.on("pointermove",(()=>{clearTimeout(this.inactivityTimer),this.idleTweens&&this.idleTweens.stop(),this.inactivityTimer=setTimeout((()=>this.getNextMove((()=>this.shuffle()))),1e3),this.inactivityTimer=setTimeout((()=>this.idle()),5e3)})),this.input.on("pointerdown",(()=>{this.particleManager.matchParticle&&(this.particleManager.matchParticle.stop(),this.isSuggested=!1)}))}tileDown(e,t,i){if(this.canMove)if(null==this.firstSelectedTile)this.firstSelectedTile=t,this.firstSelectedTile.getSelected();else{if(this.firstSelectedTile.getDeselected(),this.firstSelectedTile==t)return void(this.firstSelectedTile=void 0);if(this.secondSelectedTile=t,this.secondSelectedTile){const e=Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x)/a.tileWidth,t=Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y)/a.tileHeight;1===e&&0===t||0===e&&1===t?(this.canMove=!1,this.swapTiles()):this.firstSelectedTile=void 0}}}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.canMove=!1;const e={x:this.firstSelectedTile.x-a.tileWidth/2,y:this.firstSelectedTile.y-a.tileHeight/2},t={x:this.secondSelectedTile.x-a.tileWidth/2,y:this.secondSelectedTile.y-a.tileHeight/2};this.tileGrid[Math.floor(e.y/a.tileHeight)][e.x/a.tileWidth]=this.secondSelectedTile,this.tileGrid[Math.floor(t.y/a.tileHeight)][t.x/a.tileWidth]=this.firstSelectedTile,this.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,ease:"cubic.inout",duration:600,repeat:0,yoyo:!1,autoDestroy:!0}),this.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,ease:"cubic.inout",duration:600,repeat:0,yoyo:!1,onComplete:()=>{this.checkMatches(),this.canMove=!0},autoDestroy:!0}),this.firstSelectedTile=this.tileGrid[Math.floor(e.y/a.tileHeight)][e.x/a.tileWidth],this.secondSelectedTile=this.tileGrid[Math.floor(t.y/a.tileHeight)][t.x/a.tileWidth]}}checkMatches(){const e=h.getMatches(this.tileGrid);e.length>0&&!this.isRemoving?this.removeTileGroup(e,(()=>this.time.delayedCall(300,(()=>{this.resetTile((()=>{this.fillTile((()=>this.time.delayedCall(300,(()=>{this.tileUp((()=>{this.checkMatches()}))}))))}))})))):(this.swapTiles(),this.tileUp((()=>{this.canMove=!0})))}resetTile(e){for(let e=0;e<this.tileGrid.length;e++)for(let t=this.tileGrid[e].length-1;t>0;t--)if(void 0===this.tileGrid[t][e]&&void 0!==this.tileGrid[t-1][e]){const i=this.tileGrid[t-1][e];this.tileGrid[t][e]=i,this.tileGrid[t-1][e]=void 0,this.add.tween({targets:i,y:a.tileHeight*t+a.tileHeight/2,ease:"sine.inout",duration:100,repeat:0,yoyo:!1,autoDestroy:!0}),e=-1;break}e()}fillTile(e){let t=!1;this.canMove=!1;for(let e=0;e<this.tileGrid.length;e++)for(let i=0;i<this.tileGrid[e].length;i++)if(void 0===this.tileGrid[e][i]){const s=this.tileManager.allocItem();if(s){const a=this.tileManager.reuseTile(s,i,e,100);this.tileGrid[e][i]=a,t=!0}}this.canMove=!0,this.time.delayedCall(1e3,(()=>{t&&(this.particleManager.stopMatchParticle(!0),this.isSuggested=!1),this.canMove=!0})),e()}tileUp(e){this.secondSelectedTile&&(this.firstSelectedTile=void 0,this.secondSelectedTile=void 0),e()}removeTileGroup(e,t){this.isRemoving=!0;for(const t of e){this.emitScoreText(t);let[e,i]=[void 0,void 0];for(const e of t)e.isGlowed5()&&(i=e);if(!i)for(const i of t)i.isGlowed4()&&(e=i);e?(this.particleManager.emitGlow4(t),this.tileManager.emitGlow4(t)):i&&this.tileManager.emitGlow5(i,t),this.particleManager.emitLineToScoreboard(t),this.removeByMatch(t)}t()}removeByMatch(e){switch(e.length){case 3:this.tileManager.removeMatch3(e,(()=>{this.isRemoving=!1}));break;case 4:this.tileManager.removeMatch4(e,(()=>{this.isRemoving=!1}));break;case 5:this.tileManager.removeMatch5(e,(()=>{this.isRemoving=!1}))}}idle(){let e=0;for(let t=0;t<this.tileGrid.length;t++)for(let i=0;i<this.tileGrid.length;i++)null!=this.tileGrid[i][t]&&(this.idleTweens=this.add.tween({targets:this.tileGrid[i][t],scale:.5,ease:"sine.inout",duration:300,autoDestroy:!0,delay:50*i,repeat:2,yoyo:!0}),e++,e%8==0&&(e=0))}getNextMove(e){const[t,i]=[this.tileGrid,this.tileGrid.length],s=[[1,0],[-1,0],[0,1],[0,-1]];if(!this.isSuggested&&this.canMove){let a=!1;this.resetTile((()=>{for(let e=0;e<i;e++)for(let l=0;l<i;l++)if(void 0!==t[e][l])for(const[r,n]of s){const s=e+r,o=l+n;if(s>=0&&s<i&&o>=0&&o<i&&void 0!==t[s][o]){if([t[e][l],t[s][o]]=[t[s][o],t[e][l]],h.getMatches(t).length>0)return[t[e][l],t[s][o]]=[t[s][o],t[e][l]],void(!this.isSuggested&&this.canMove&&(this.canMove=!1,h.emitSuggestion(t[e][l],t[s][o],(()=>this.canMove=!0)),this.isSuggested=!0));[t[e][l],t[s][o]]=[t[s][o],t[e][l]],e==i-1&&l==i-1&&(a=!0)}}})),this.canMove&&!this.isRedisting&&a&&(this.canMove=!1,this.tileUp((()=>{this.time.delayedCall(800,(()=>{e()}))})))}}emitScoreText(e){this.scoreText.setPosition(e[1].x-20,e[1].y-5);const t=e.length;this.scoreText.setText(a.matchScore[t]),this.scoreText.setAlpha(1),this.add.tween({targets:this,alpha:0,duration:500,ease:"sine.inout",autoDestroy:!0,onStart:()=>{this.canMove=!1},onComplete:()=>{this.registry.values.score+=parseInt(a.matchScore[t]),this.scoreText.setAlpha(0),this.events.emit("scoreChanged"),(this.registry.values.score%a.milestone==0&&this.registry.values.score>0||this.registry.get("score")>this.registry.get("level")*a.milestone)&&(this.particleManager.stopMatchParticle(!0),this.isSuggested=!0,this.particleManager.emitConfetti(128),this.tileUp((()=>{this.time.delayedCall(1200,(()=>{this.canMove&&!this.isRedisting&&this.shuffle()}))})),this.canMove=!0)}})}shuffle(){if(!this.isRedisting){this.particleManager.stopMatchParticle(!0),this.isRedisting=!0,this.canMove=!1;const e=this.tileGrid.flat().filter((e=>null!=e)),t=a.shape[Phaser.Math.RND.between(0,a.shape.length-1)],i=this.createPattern(e,t);this.add.tween({targets:i,radius:200,ease:"sine.inout",yoyo:!0,duration:1e3,autoDestroy:!0,onStart:()=>{this.particleManager.stopMatchParticle(!0)},onUpdate:()=>this.onUpdateShuffle(e,t),onComplete:()=>this.onCompleteShuffle()})}}createPattern(e,t){const i=this.add.group(e);let s;return"circle"===t?(s=new Phaser.Geom.Circle(...a.circle),Phaser.Actions.PlaceOnCircle(i.getChildren(),s)):"triangle"===t?(s=new Phaser.Geom.Triangle(...a.triangle),Phaser.Actions.PlaceOnTriangle(i.getChildren(),s)):"rectangle"===t&&(s=new Phaser.Geom.Rectangle(...a.rectangle),Phaser.Actions.PlaceOnRectangle(i.getChildren(),s)),s}onUpdateShuffle(e,t){"circle"===t?Phaser.Actions.RotateAroundDistance(e,{x:255,y:287.5},.02,200):Phaser.Actions.RotateAround(e,{x:255,y:287.5},.02)}onCompleteShuffle(){var e,t;this.isRedisting=!1,clearTimeout(this.inactivityTimer);let i=200;for(let s=0;s<a.gridHeight;s++)for(let l=0;l<a.gridWidth;l++){const r=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];null===(e=this.tileGrid[s][l])||void 0===e||e.setTexture("tiles",r),null===(t=this.tileGrid[s][l])||void 0===t||t.revealImageWithDelay(l*a.tileWidth+a.tileWidth/2,s*a.tileHeight+a.tileHeight/2,i),i+=10}this.isSuggested=!0,this.canMove=!0,this.time.delayedCall(2e3,(()=>{this.checkMatches(),this.particleManager.stopMatchParticle(!1),this.isSuggested=!1}))}}class p extends Phaser.Scene{constructor(){super({key:"HUDScene"})}create(){this.target=a.milestone,this.createLoadingbar(),this.progressParticle=this.add.particles(524,157.5,"flares",{y:{min:-5,max:5},frame:"white",color:[6923985,9756671,13233135],lifespan:800,angle:{min:90,max:270},scale:{start:.07,end:0,ease:"sine.in"},speed:{min:20,max:30},blendMode:"NORMAL",quantity:3}).setAlpha(0).setDepth(2),this.textElements=new Map([["TARGET",this.addText(520,8,"Goal: "+this.registry.get("level")*a.milestone)],["LEVEL",this.addText(520,48,`Level: ${this.registry.get("level")}`)],["SCORE",this.addText(520,88,`Score: ${this.registry.get("score")}`)]]);const e=this.scene.get("GameScene");e.events.on("scoreChanged",this.updateScore,this),e.events.on("levelChanged",this.updateLevel,this)}addText(e,t,i){return this.add.bitmapText(e,t,"font",i,35)}updateProgress(){this.tweens.add({targets:this.progressBar,width:228*this.registry.get("score")/this.target,duration:200,ease:"sine.inout",onComplete:()=>{this.progressParticle.setAlpha(1),this.progressParticle.setX(528+180*this.registry.get("score")/this.target)}})}updateScore(){var e;console.log(this.registry.get("score")),null===(e=this.textElements.get("SCORE"))||void 0===e||e.setText(`Score: ${this.registry.get("score")}`),this.updateProgress(),!this.textLock&&this.registry.get("score")%a.milestone==0&&this.registry.get("score")>0||this.registry.get("score")>this.registry.get("level")*a.milestone?(this.registry.values.level+=1,this.textLock=!0,this.updateLevel(),this.updateScore(),this.progressParticle.setAlpha(0)):this.textLock=!1}updateLevel(){var e,t,i;null===(e=this.textElements.get("LEVEL"))||void 0===e||e.setAlpha(0),this.target+=a.milestone,null===(t=this.textElements.get("TARGET"))||void 0===t||t.setText(`Goal: ${this.target}`),null===(i=this.textElements.get("LEVEL"))||void 0===i||i.setAlpha(1).setText(`Level: ${this.registry.get("level")}`),this.updateProgress()}createLoadingbar(){this.loadingBar=this.add.nineslice(520,160,"ui","ButtonOrange"),this.progressBar=this.add.nineslice(528,158,"ui","ButtonOrangeFill1",0,16,6,6),this.loadingBar.setOrigin(0,.5).setScale(.75,.6).setDepth(1),this.progressBar.setOrigin(0,.5).setScale(.75,.6).setDepth(3)}}const u={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",width:715,height:575,type:Phaser.WEBGL,parent:"game",scene:[s,g,p],scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},backgroundColor:"#ffd1dc",render:{pixelArt:!1,antialias:!0},fps:{target:60,forceSetTimeOut:!0},clearBeforeRender:!1,powerPreference:"high-performance",batchSize:1024};class m extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new m(u)}))}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var l=i[e]={exports:{}};return t[e].call(l.exports,l,l.exports,s),l.exports}s.m=t,e=[],s.O=(t,i,a,l)=>{if(!i){var r=1/0;for(c=0;c<e.length;c++){for(var[i,a,l]=e[c],h=!0,n=0;n<i.length;n++)(!1&l||r>=l)&&Object.keys(s.O).every((e=>s.O[e](i[n])))?i.splice(n--,1):(h=!1,l<r&&(r=l));if(h){e.splice(c--,1);var o=a();void 0!==o&&(t=o)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[i,a,l]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,l,[r,h,n]=i,o=0;if(r.some((t=>0!==e[t]))){for(a in h)s.o(h,a)&&(s.m[a]=h[a]);if(n)var c=n(s)}for(t&&t(i);o<r.length;o++)l=r[o],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(c)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[216],(()=>s(431)));a=s.O(a)})();