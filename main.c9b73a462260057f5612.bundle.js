(()=>{"use strict";var e,t={591:(e,t,i)=>{i(260);class s extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.atlas("flares","assets/particles/flares.png","assets/particles/flares.json"),this.load.atlas("confetti","assets/particles/confetti.png","assets/particles/confetti.json"),this.load.image("flare","assets/particles/white-flare.png"),this.load.image("pixel-yellow","assets/particles/pixel_yellow.png"),this.load.image("pixel-white","assets/particles/pixel_white.png"),this.load.image("pixel-red","assets/particles/pixel_red.png"),this.load.image("pixel-green","assets/particles/pixel_green.png"),this.load.image("pixel-blue","assets/particles/pixel_blue.png")}init(){this.registry.set("level",1),this.registry.set("score",0)}update(){this.scene.start("HUDScene"),this.scene.start("GameScene"),this.scene.bringToTop("HUDScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const l={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,milestone:2e3,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"],shape:["triangle","rectangle","circle"],matchScore:["0","0","0","100","200","300","400","500"],triangle:[255,87.5,255-200*Math.cos(Math.PI/6),287.5+200*Math.sin(Math.PI/6),255+200*Math.cos(Math.PI/6),287.5+200*Math.sin(Math.PI/6)],circle:[300,400,200],rectangle:[255-200*Math.cos(Math.PI/4),287.5-200*Math.sin(Math.PI/4),400*Math.cos(Math.PI/4),400*Math.cos(Math.PI/4)]};class r extends Phaser.GameObjects.Sprite{constructor(e){if(super(e.scene,e.x,e.y,e.texture,e.frame),this.setOrigin(.5,.5),this.setScale(.8),this.setInteractive(),e.delay){const t=this.y;this.y=t-this.height,this.scene.tweens.add({targets:this,y:t,ease:"Power3",autoDestroy:!0,duration:200,delay:e.delay})}this.scene.add.existing(this);const t=new Phaser.Display.BaseShader("BufferShader2",h);this.selectedShader=this.scene.add.shader(t,this.x-5,this.y,1.2*this.width,1.2*this.height).setDepth(-1).setVisible(!1)}revealImageWithDelay(e,t,i){this.scene.tweens.add({targets:this,x:e,y:t,alpha:1,ease:"Power3",autoDestroy:!0,duration:400,delay:i})}getSelected(){this.selectedShader.setX(this.x-5),this.selectedShader.setY(this.y),this.selectedShader.setVisible(!0)}getDeselected(){this.selectedShader.setVisible(!1)}getAttracted(){this.suggestedTween||(this.suggestedTween=this.scene.tweens.add({targets:this,scale:.9,yoyo:!0,ease:"bounce.in",autoDestroy:!0,repeat:0,duration:500,onComplete:()=>{var e;null===(e=this.suggestedTween)||void 0===e||e.stop(),this.suggestedTween=void 0,this.setAlpha(1)}}))}enableGlow4(){this.isGlow4=!0}enableGlow5(){this.isGlow5=!0}disableGlow(){var e;null===(e=this.match4Tween)||void 0===e||e.destroy(),this.match4Tween=void 0,this.isGlow4=!1,this.isGlow5=!1}isGlowed4(){return this.isGlow4}isGlowed5(){return this.isGlow5}shake(){this.scene.tweens.add({targets:this,scale:0,ease:"bounce.inout",autoDestroy:!0,duration:50,onComplete:()=>{this.destroy()}})}wipe(e,t){"LEFT"==e?this.scene.tweens.add({targets:this,progress:1,x:this.x-15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}}):"RIGHT"==e?this.scene.tweens.add({targets:this,progress:1,x:this.x+15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}}):"UP"==e?this.scene.tweens.add({targets:this,progress:1,y:this.y-15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}}):"DOWN"==e&&this.scene.tweens.add({targets:this,progress:1,y:this.y+15,alpha:0,duration:100,easing:"quint.out",delay:t,onComplete:()=>{this.setActive(!1),this.setAlpha(0)}})}}const h="\nprecision mediump float;\n\nuniform float time;\nuniform vec2 resolution;\nuniform vec2 mouse;\n\nvarying vec2 fragCoord;\n\nvoid main (void)\n{\n    float intensity = 0.;\n\n    for (float i = 0.; i < 54.; i++)\n    {\n        float angle = i/27. * 3.14159;\n        vec2 xy = vec2(0.27 * cos(angle), 0.27 * sin(angle));\n        xy += fragCoord.xy/resolution.y-0.5;\n        intensity += pow(1000000., (0.77 - length(xy) * 1.9) * (1. + 0.275 * fract(-i / 27. - time))) / 80000.;\n    }\n\n    gl_FragColor = vec4(clamp(intensity * vec3(0.0927, 0.396, 0.17), vec3(0.), vec3(0.5)), 0.);\n}\n";class a{constructor(e){this.scene=e,this.tilePool=[],this.tileGrid=[];for(let e=0;e<l.gridHeight;e++){this.tileGrid[e]=[];for(let t=0;t<l.gridWidth;t++)this.tileGrid[e][t]=this.addTile(t,e).setAlpha(0)}}returnItem(e){this.tilePool.push(e)}allocItem(){var e;if(this.tilePool.length>0)return null===(e=this.tilePool)||void 0===e?void 0:e.pop();throw new Error("Pool is empty")}addTile(e,t,i){const s=l.candyTypes[Phaser.Math.RND.between(0,l.candyTypes.length-1)];return new r({scene:this.scene,x:e*l.tileWidth+l.tileWidth/2,y:t*l.tileHeight+l.tileHeight/2,texture:s,delay:i})}revealTiles(){var e,t,i,s;let r=300;for(let h=l.gridHeight-1;h>=0;h--)for(let a=0;a<l.gridWidth;a++){const l=null===(e=this.tileGrid[h][a])||void 0===e?void 0:e.y;null===(t=this.tileGrid[h][a])||void 0===t||t.setY(-200),l&&(null===(i=this.tileGrid[h][a])||void 0===i||i.revealImageWithDelay(null===(s=this.tileGrid[h][a])||void 0===s?void 0:s.x,l,r)),r+=20}}reuseTile(e,t,i,s){const r=l.candyTypes[Phaser.Math.RND.between(0,l.candyTypes.length-1)];return e.setTexture(r).setAlpha(0),e.setPosition(t*l.tileWidth+l.tileWidth/2,-100),e.revealImageWithDelay(t*l.tileWidth+l.tileWidth/2,i*l.tileHeight+l.tileHeight/2,s),e}getTilePos(e,t){const i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let l=0;l<e[s].length;l++)if(t===e[s][l]){i.x=l,i.y=s;break}return i}emitGlow4(e){var t,i,s,l;const r=e[0].x==e[1].x;for(const h of e){const e=h,a=this.getTilePos(this.tileGrid,e);-1!==a.x&&-1!==a.y&&(r?(a.x>0&&this.tileGrid[a.y][a.x-1]&&(this.returnItem(this.tileGrid[a.y][a.x-1]),null===(s=this.tileGrid[a.y][a.x-1])||void 0===s||s.setActive(!1).setAlpha(0),this.tileGrid[a.y][a.x-1]=void 0),a.x<7&&this.tileGrid[a.y][a.x+1]&&(this.returnItem(this.tileGrid[a.y][a.x+1]),null===(l=this.tileGrid[a.y][a.x+1])||void 0===l||l.setActive(!1).setAlpha(0),this.tileGrid[a.y][a.x+1]=void 0)):(a.y>0&&this.tileGrid[a.y-1][a.x]&&(this.returnItem(this.tileGrid[a.y-1][a.x]),null===(t=this.tileGrid[a.y-1][a.x])||void 0===t||t.setActive(!1).setAlpha(0),this.tileGrid[a.y-1][a.x]=void 0),a.y<7&&this.tileGrid[a.y+1][a.x]&&(this.returnItem(this.tileGrid[a.y+1][a.x]),null===(i=this.tileGrid[a.y+1][a.x])||void 0===i||i.setActive(!1).setAlpha(0),this.tileGrid[a.y+1][a.x]=void 0)))}for(const t of e)t.disableGlow()}emitGlow5(e,t){var i,s,l,r;const h=this.getTilePos(this.tileGrid,e);if(-1!==h.x&&-1!==h.y){for(let e=h.y-1;e>=0;e--)this.tileGrid[e][h.x]&&(null===(i=this.tileGrid[e][h.x])||void 0===i||i.wipe("UP",5*(h.y-1-e)),this.returnItem(this.tileGrid[e][h.x]),this.tileGrid[e][h.x]=void 0);for(let e=h.y+1;e<8;e++)this.tileGrid[e][h.x]&&(null===(s=this.tileGrid[e][h.x])||void 0===s||s.wipe("DOWN",5*(e-h.y)),this.returnItem(this.tileGrid[e][h.x]),this.tileGrid[e][h.x]=void 0);for(let e=h.x-1;e>=0;e--)this.tileGrid[h.y][e]&&(null===(l=this.tileGrid[h.y][e])||void 0===l||l.wipe("LEFT",5*(h.x-1-e)),this.returnItem(this.tileGrid[h.y][e]),this.tileGrid[h.y][e]=void 0);for(let e=h.x+1;e<8;e++)this.tileGrid[h.y][e]&&(null===(r=this.tileGrid[h.y][e])||void 0===r||r.wipe("RIGHT",5*(e-h.x)),this.returnItem(this.tileGrid[h.y][e]),this.tileGrid[h.y][e]=void 0)}for(const e of t)e.disableGlow()}removeMatch3(e,t){for(const t of e){const e=this.getTilePos(this.tileGrid,t);-1!==e.x&&-1!==e.y&&(this.returnItem(t),this.tileGrid[e.y][e.x]=void 0)}t()}removeMatch4(e,t){this.scene.add.tween({targets:[e[0],e[3],e[1]],x:e[2].x,y:e[2].y,duration:100,autoDestroy:!0,ease:"sine.in",onComplete:()=>{for(let t=0;t<4;t++){const i=e[t],s=this.getTilePos(this.tileGrid,i);2!=t&&-1!==s.x&&-1!==s.y&&(this.returnItem(i),this.tileGrid[s.y][s.x]=void 0)}e[2].enableGlow4(),t()}})}removeMatch5(e,t){this.scene.add.tween({targets:[e[0],e[1],e[3],e[4]],x:e[2].x,y:e[2].y,duration:100,autoDestroy:!0,ease:"sine.in",onComplete:()=>{for(let t=0;t<5;t++){const i=e[t],s=this.getTilePos(this.tileGrid,i);2!=t&&-1!==s.x&&-1!==s.y&&(this.returnItem(i),this.tileGrid[s.y][s.x]=void 0)}e[2].enableGlow5(),t()}})}}class o extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e)}update(e,t,i){const s=super.update(e,t,i);return this.accelerationY=-this.velocityY,this.accelerationX=-2*this.velocityX,s}}class n extends Phaser.Scene{constructor(){super({key:"GameScene"})}init(){this.tileManager=new a(this),this.canMove=!0,this.isSuggested=!1,this.isRedisting=!1,this.isRemoving=!1,this.cameras.main.setBackgroundColor(9805),this.scoreText=this.add.text(-100,-100,"100",{fontSize:"24px",color:"#fff",fontStyle:"bold"}).setDepth(2),this.tileGrid=this.tileManager.tileGrid,this.tileManager.revealTiles(),this.time.delayedCall(2e3,(()=>{this.checkMatches()})),this.input.on("gameobjectdown",this.tileDown,this),this.input.on("pointermove",(()=>{clearTimeout(this.inactivityTimer),this.idleTweens&&this.idleTweens.stop(),this.inactivityTimer=setTimeout((()=>this.getNextMove((()=>this.shuffle()))),3e3),this.inactivityTimer=setTimeout((()=>this.idle()),5e3)})),this.input.on("pointerdown",(()=>{this.matchParticle&&(this.matchParticle.stop(),this.isSuggested=!1)})),this.confettiParticle=this.add.particles(0,585,"confetti",{frame:{frames:["blue.png","green.png","red.png"],cycle:!0},lifespan:5e3,speed:{min:650,max:1200},angle:{min:-60,max:-50},scale:{start:.3,end:0},gravityY:300,blendMode:"ADD",emitting:!1,frequency:60,quantity:5,particleClass:o}),this.matchParticle=this.add.particles(0,0,"flares",{frame:{frames:["red","green","blue"],cycle:!0},blendMode:"ADD",lifespan:500,emitting:!1,scale:{start:.5,end:.1},duration:500}),this.explodeParticle=this.add.particles(0,0,"flare",{speed:24,lifespan:1500,quantity:10,scale:{start:.3,end:0},emitting:!1,duration:300}),this.match3x3Particle=this.add.particles(0,0,"flares",{frame:{frames:["red","green","blue"],cycle:!0},blendMode:"ADD",lifespan:250,emitting:!1,scale:{start:.5,end:.1},duration:300})}tileDown(e,t,i){if(this.canMove)if(null==this.firstSelectedTile)this.firstSelectedTile=t,this.firstSelectedTile.getSelected();else{if(this.firstSelectedTile.getDeselected(),this.firstSelectedTile==t)return void(this.firstSelectedTile=void 0);this.secondSelectedTile=t,this.secondSelectedTile&&(Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x),Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y),this.canMove=!1,this.swapTiles())}}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){this.canMove=!1;const e={x:this.firstSelectedTile.x-this.firstSelectedTile.width/2,y:this.firstSelectedTile.y-this.firstSelectedTile.height/2},t={x:this.secondSelectedTile.x-this.firstSelectedTile.width/2,y:this.secondSelectedTile.y-this.firstSelectedTile.height/2};this.tileGrid[Math.floor(e.y/l.tileHeight)][e.x/l.tileWidth]=this.secondSelectedTile,this.tileGrid[Math.floor(t.y/l.tileHeight)][t.x/l.tileWidth]=this.firstSelectedTile,this.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,ease:"cubic.inout",duration:600,repeat:0,yoyo:!1,autoDestroy:!0}),this.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,ease:"cubic.inout",duration:600,repeat:0,yoyo:!1,onComplete:()=>{this.checkMatches(),this.canMove=!0},autoDestroy:!0}),this.firstSelectedTile=this.tileGrid[Math.floor(e.y/l.tileHeight)][e.x/l.tileWidth],this.secondSelectedTile=this.tileGrid[Math.floor(t.y/l.tileHeight)][t.x/l.tileWidth]}}checkMatches(){const e=this.getMatches(this.tileGrid);e.length>0&&!this.isRemoving?this.removeTileGroup(e,(()=>this.time.delayedCall(300,(()=>{this.resetTile((()=>{this.fillTile((()=>this.time.delayedCall(300,(()=>{this.tileUp((()=>{this.checkMatches()}))}))))}))})))):this.tileUp((()=>{this.canMove=!0}))}resetTile(e){for(let e=0;e<this.tileGrid.length;e++)for(let t=this.tileGrid[e].length-1;t>0;t--)if(void 0===this.tileGrid[t][e]&&void 0!==this.tileGrid[t-1][e]){const i=this.tileGrid[t-1][e];this.tileGrid[t][e]=i,this.tileGrid[t-1][e]=void 0,this.add.tween({targets:i,y:l.tileHeight*t+l.tileHeight/2,ease:"sine.inout",duration:100,repeat:0,yoyo:!1,autoDestroy:!0}),e=-1;break}e()}fillTile(e){let t=!1;this.canMove=!1;for(let e=0;e<this.tileGrid.length;e++)for(let i=0;i<this.tileGrid[e].length;i++)if(void 0===this.tileGrid[e][i]){const s=this.tileManager.allocItem();if(s){const l=this.tileManager.reuseTile(s,i,e,100);this.tileGrid[e][i]=l,t=!0}}this.canMove=!0,this.time.delayedCall(1e3,(()=>{this.matchParticle&&t&&(this.matchParticle.stop(),this.isSuggested=!1),this.canMove=!0})),e()}tileUp(e){this.secondSelectedTile&&(this.firstSelectedTile=void 0,this.secondSelectedTile=void 0),e()}removeTileGroup(e,t){this.isRemoving=!0;for(const t of e){this.emitScoreText(t);let[e,i]=[void 0,void 0];for(const e of t)e.isGlowed5()&&(i=e);if(!i)for(const i of t)i.isGlowed4()&&(e=i);switch(e?this.emitGlow4(t):i&&this.emitGlow5(i,t),this.emitLineToScoreboard(t),t.length){case 3:this.tileManager.removeMatch3(t,(()=>{this.isRemoving=!1}));break;case 4:this.tileManager.removeMatch4(t,(()=>{this.isRemoving=!1}));break;case 5:this.tileManager.removeMatch5(t,(()=>{this.isRemoving=!1}))}}t()}getMatches(e){const t=[];let i=[];for(const s of e){const e=s;i=[];for(let l=0;l<e.length;l++)l<e.length-2&&s[l]&&s[l+1]&&s[l+2]&&s[l].texture.key===s[l+1].texture.key&&s[l+1].texture.key===s[l+2].texture.key&&(i.length>0&&-1==i.indexOf(s[l])&&(t.push(i),i=[]),-1==i.indexOf(s[l])&&i.push(s[l]),-1==i.indexOf(s[l+1])&&i.push(s[l+1]),-1==i.indexOf(s[l+2])&&i.push(s[l+2]));i.length>0&&t.push(i)}for(let s=0;s<e.length;s++){const l=e[s];i=[];for(let r=0;r<l.length;r++)r<l.length-2&&e[r][s]&&e[r+1][s]&&e[r+2][s]&&e[r][s].texture.key===e[r+1][s].texture.key&&e[r+1][s].texture.key===e[r+2][s].texture.key&&(i.length>0&&-1==i.indexOf(e[r][s])&&(t.push(i),i=[]),-1==i.indexOf(e[r][s])&&i.push(e[r][s]),-1==i.indexOf(e[r+1][s])&&i.push(e[r+1][s]),-1==i.indexOf(e[r+2][s])&&i.push(e[r+2][s]));i.length>0&&t.push(i)}return t}idle(){let e=0;for(let t=0;t<this.tileGrid.length;t++)for(let i=0;i<this.tileGrid.length;i++)null!=this.tileGrid[i][t]&&(this.idleTweens=this.add.tween({targets:this.tileGrid[i][t],scale:.5,ease:"sine.inout",duration:300,autoDestroy:!0,delay:50*i,repeat:2,yoyo:!0}),e++,e%8==0&&(e=0))}getNextMove(e){if(!this.isSuggested&&this.canMove){let t=!1;this.resetTile((()=>{for(let e=0;e<this.tileGrid.length;e++)for(let i=0;i<this.tileGrid.length;i++)if(void 0!==this.tileGrid[e][i])for(const[s,l]of[[1,0],[-1,0],[0,1],[0,-1]]){const r=e+s,h=i+l;if(r>=0&&r<this.tileGrid.length&&h>=0&&h<this.tileGrid.length&&void 0!==this.tileGrid[r][h]){[this.tileGrid[e][i],this.tileGrid[r][h]]=[this.tileGrid[r][h],this.tileGrid[e][i]];const s=this.getMatches(this.tileGrid);if(s.length>0)return[this.tileGrid[e][i],this.tileGrid[r][h]]=[this.tileGrid[r][h],this.tileGrid[e][i]],void(!this.isSuggested&&this.canMove&&(this.emitSuggestion(s[0],this.tileGrid[e][i],this.tileGrid[r][h]),this.isSuggested=!0));[this.tileGrid[e][i],this.tileGrid[r][h]]=[this.tileGrid[r][h],this.tileGrid[e][i]],e==this.tileGrid.length-1&&i==this.tileGrid.length-1&&(t=!0)}}})),this.canMove&&!this.isRedisting&&t&&(this.canMove=!1,this.tileUp((()=>{this.time.delayedCall(500,(()=>{e()}))})))}}emitSuggestion(e,t,i){t.getAttracted(),i.getAttracted();const[s,l]=[e.reduce(((e,t)=>Math.min(t.x,e)),Number.MAX_SAFE_INTEGER),e.reduce(((e,t)=>Math.min(t.y,e)),Number.MAX_SAFE_INTEGER)],[r,h]=[e.reduce(((e,t)=>Math.max(t.x,e)),Number.MIN_SAFE_INTEGER)+e[0].width,e.reduce(((e,t)=>Math.max(t.y,e)),Number.MIN_SAFE_INTEGER)+e[0].width],a=new Phaser.Geom.Rectangle(-e[0].width/2,-e[0].height/2,-s+r,-l+h),o=this.matchParticle.setPosition(s,l).addEmitZone({type:"edge",source:a,quantity:32,total:1});this.matchParticle.start(1500),this.time.delayedCall(1500,(()=>{this.matchParticle.removeEmitZone(o[0])}))}emitScoreText(e){console.log("score"),this.scoreText.setPosition(e[1].x-20,e[1].y-5);const t=e.length;this.scoreText.setText(l.matchScore[t]),this.scoreText.setAlpha(1),this.add.tween({targets:this,alpha:0,duration:500,ease:"sine.inout",autoDestroy:!0,onStart:()=>{this.canMove=!1},onComplete:()=>{this.registry.values.score+=parseInt(l.matchScore[t]),this.scoreText.setAlpha(0),this.events.emit("scoreChanged"),(this.registry.values.score%l.milestone==0&&this.registry.values.score>0||this.registry.get("score")>this.registry.get("level")*l.milestone)&&(this.matchParticle&&this.matchParticle.stop(!0),this.isSuggested=!0,this.confettiParticle.explode(128),this.tileUp((()=>{this.time.delayedCall(1200,(()=>{this.canMove&&!this.isRedisting&&this.shuffle()}))})),this.canMove=!0)}})}emitGlow4(e){const t=new Phaser.Geom.Rectangle(e[1].x-3*e[0].width/2,e[1].y-3*e[0].height/2,3*e[0].width,3*e[0].height),i=this.explodeParticle.addEmitZone({type:"edge",source:t,quantity:22});this.explodeParticle.start(0,300),this.time.delayedCall(300,(()=>{this.explodeParticle.removeEmitZone(i[0])})),this.tileManager.emitGlow4(e)}emitGlow5(e,t){this.tileManager.emitGlow5(e,t)}emitLineToScoreboard(e){const t=new Phaser.Geom.Line(0,0,520-e[0].x,100-e[0].y);this.match3x3Particle.setPosition(e[0].x,e[0].y);const i=this.match3x3Particle.addEmitZone({type:"edge",source:t,quantity:32,total:1});this.match3x3Particle.start(300),this.time.delayedCall(500,(()=>{this.match3x3Particle.removeEmitZone(i[0])}))}shuffle(){if(!this.isRedisting){console.log("shuffle"),this.matchParticle&&this.matchParticle.stop(),this.isRedisting=!0,this.canMove=!1;const e=this.tileGrid.flat().filter((e=>null!=e));for(const t of e)t.setPosition(255,287.5);const t=this.add.group(e),i=l.shape[Phaser.Math.RND.between(0,l.shape.length-1)];let s;"circle"===i?(s=new Phaser.Geom.Circle(...l.circle),Phaser.Actions.PlaceOnCircle(t.getChildren(),s)):"triangle"===i?(s=new Phaser.Geom.Triangle(...l.triangle),Phaser.Actions.PlaceOnTriangle(t.getChildren(),s)):"rectangle"===i&&(s=new Phaser.Geom.Rectangle(...l.rectangle),Phaser.Actions.PlaceOnRectangle(t.getChildren(),s)),this.add.tween({targets:s,radius:200,ease:"sine.inout",yoyo:!0,duration:1e3,autoDestroy:!0,onStart:()=>{this.matchParticle&&(this.matchParticle.stop(!0),this.matchParticle.setAlpha(0))},onUpdate:function(){"circle"===i?Phaser.Actions.RotateAroundDistance(e,{x:255,y:287.5},.02,200):Phaser.Actions.RotateAround(e,{x:255,y:287.5},.02)},onComplete:()=>{var e,t;this.isRedisting=!1,clearTimeout(this.inactivityTimer);let i=200;for(let s=0;s<l.gridHeight;s++)for(let r=0;r<l.gridWidth;r++){const h=l.candyTypes[Phaser.Math.RND.between(0,l.candyTypes.length-1)];null===(e=this.tileGrid[s][r])||void 0===e||e.setTexture(h),null===(t=this.tileGrid[s][r])||void 0===t||t.revealImageWithDelay(r*l.tileWidth+l.tileWidth/2,s*l.tileHeight+l.tileHeight/2,i),i+=10}this.isSuggested=!0,this.canMove=!0,this.time.delayedCall(2e3,(()=>{this.checkMatches(),this.matchParticle&&(this.matchParticle.stop(),this.matchParticle.setAlpha(1),this.isSuggested=!1)}))}})}}}class d extends Phaser.Scene{constructor(){super({key:"HUDScene"})}create(){this.target=l.milestone,this.createLoadingbar(),this.progressParticle=this.add.particles(520,160,"flares",{frame:"white",color:[11454159,9887962,9666291],colorEase:"quart.out",lifespan:250,angle:{min:160,max:200},scale:{start:.21,end:0,ease:"sine.in"},speed:{min:50,max:100},advance:2e3,blendMode:"ADD"}).setAlpha(0).setDepth(2),this.textElements=new Map([["TARGET",this.addText(520,8,"Goal: "+this.registry.get("level")*l.milestone)],["LEVEL",this.addText(520,48,`Level: ${this.registry.get("level")}`)],["SCORE",this.addText(520,88,`Score: ${this.registry.get("score")}`)]]);const e=this.scene.get("GameScene");e.events.on("scoreChanged",this.updateScore,this),e.events.on("levelChanged",this.updateLevel,this)}addText(e,t,i){return this.add.bitmapText(e,t,"font",i,35)}updateProgress(){this.progressBar.clear(),this.progressBar.fillStyle(8900331,1),this.progressBar.fillRect(522,152,180*this.registry.get("score")/this.target,16),this.progressParticle.setAlpha(1),this.progressParticle.setX(522+180*this.registry.get("score")/this.target)}updateScore(){var e;null===(e=this.textElements.get("SCORE"))||void 0===e||e.setText(`Score: ${this.registry.get("score")}`),this.updateProgress(),!this.textLock&&this.registry.get("score")%l.milestone==0&&this.registry.get("score")>0||this.registry.get("score")>this.registry.get("level")*l.milestone?(this.registry.values.level+=1,this.textLock=!0,this.time.delayedCall(300,(()=>{this.updateLevel(),this.updateScore(),this.progressParticle.setAlpha(0)}))):this.textLock=!1}updateLevel(){var e,t,i;null===(e=this.textElements.get("LEVEL"))||void 0===e||e.setAlpha(0),this.target+=l.milestone,null===(t=this.textElements.get("TARGET"))||void 0===t||t.setText(`Goal: ${this.target}`),null===(i=this.textElements.get("LEVEL"))||void 0===i||i.setAlpha(1).setText(`Level: ${this.registry.get("level")}`),this.updateProgress()}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(19597,1),this.loadingBar.fillRect(520,150,182,20),this.progressBar=this.add.graphics()}}const c={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",width:715,height:575,type:Phaser.AUTO,parent:"game",scene:[s,n,d],scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},backgroundColor:"#ffd1dc",render:{pixelArt:!1,antialias:!0},fps:{target:60,forceSetTimeOut:!0}};class g extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new g(c)}))}},i={};function s(e){var l=i[e];if(void 0!==l)return l.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,i,l,r)=>{if(!i){var h=1/0;for(d=0;d<e.length;d++){for(var[i,l,r]=e[d],a=!0,o=0;o<i.length;o++)(!1&r||h>=r)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(a=!1,r<h&&(h=r));if(a){e.splice(d--,1);var n=l();void 0!==n&&(t=n)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[i,l,r]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var l,r,[h,a,o]=i,n=0;if(h.some((t=>0!==e[t]))){for(l in a)s.o(a,l)&&(s.m[l]=a[l]);if(o)var d=o(s)}for(t&&t(i);n<h.length;n++)r=h[n],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var l=s.O(void 0,[216],(()=>s(591)));l=s.O(l)})();